<script src="sigma.min.js"></script>
<script src=dijkstra.js></script>

<html>
<head>
    <title>RIGHT ONE</title>

    <style>
        #base {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>

<h1>Dijkstra Algorithm</h1>

<div id="base"></div>
<script>

    const s = new sigma({
        renderer: {
            container: document.getElementById('base'),
            type: 'canvas'
        },
        settings: {
            autoRescale: false,
        }
    });

    const dom = document.querySelector('#base canvas:last-child');
    const c = s.camera;

    s.bind("clickNode", function (e) {

        s.graph.addEdge({
            id : "edge",
            source : "0",
            target : "1"
        });

        s.refresh();

        calculatePath("0","1");
    });

    let i = 0;


    dom.addEventListener("click", function (e) {

        let x = sigma.utils.getX(e) - dom.offsetWidth / 2;
        let y = sigma.utils.getY(e) - dom.offsetHeight / 2;

        let p = c.cameraPosition(x, y);
        x = p.x;
        y = p.y;

        s.graph.addNode({
            id: (i++).toString(),
            size: 10,
            x: x,
            y: y,
        });

        frame();
    }, false);

    s.refresh();

    function calculatePath(srcNode, destNode) {

        const path = s.graph.dijkstra(srcNode, destNode);

        if (path) {
            for (let i = 0; i < path.length; i++) {

                (function (index) {
                    setTimeout(function () {
                        path[index].color = "#090";
                        s.refresh();
                    }, i * 1000)
                })(i);
            }
        }

        s.graph.nodes(srcNode).color = "#090";
        s.graph.nodes(destNode).color = "#090";
    }

    function frame() {
        s.refresh();
        requestAnimationFrame(frame);
    }


</script>
</body>
</html>
